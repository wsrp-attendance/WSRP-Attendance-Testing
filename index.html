<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 2em;
      }
      #spinner {
        margin: 20px auto;
        width: 40px;
        height: 40px;
        border: 5px solid #ccc;
        border-top-color: #007bff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        display: none;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      #status {
        margin-top: 20px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <h2>üìç GPS Check-In</h2>
    <div id="spinner" class="spinner"></div>
    <p id="status">Getting your location...</p>

    <form id="checkinForm" method="POST" style="display:none">
      <input type="hidden" name="uid" id="uid">
      <input type="hidden" name="latitude" id="lat">
      <input type="hidden" name="longitude" id="lng">
    </form>

    <script>
      function generateUID() {
        return 'UID-' + Math.random().toString(36).substr(2, 9);
      }

      function submitForm(uid, lat, lng) {
        document.getElementById("uid").value = uid;
        document.getElementById("lat").value = lat;
        document.getElementById("lng").value = lng;
        document.getElementById("checkinForm").submit();
      }

      function showError(message) {
        document.getElementById("status").innerText = message;
        document.getElementById("spinner").style.display = "none";
      }

      document.addEventListener("DOMContentLoaded", () => {
        const spinner = document.getElementById("spinner");
        spinner.style.display = "block";

        if (!navigator.geolocation) {
          showError("Geolocation is not supported by your browser.");
          return;
        }

        navigator.geolocation.getCurrentPosition(
          position => {
            const uid = generateUID();
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;

            document.getElementById("status").innerText = "Location verified. Submitting...";
            submitForm(uid, lat, lng);
          },
          error => {
            switch (error.code) {
              case error.PERMISSION_DENIED:
                showError("Location permission denied.");
                break;
              case error.POSITION_UNAVAILABLE:
                showError("Location information is unavailable.");
                break;
              case error.TIMEOUT:
                showError("Location request timed out.");
                break;
              default:
                showError("An unknown error occurred.");
                break;
            }
          },
          { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
        );
      });
    </script>
  </body>
</html>
